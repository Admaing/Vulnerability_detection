import psutil

PortPool = list(range(13107))


def NetPortPid(port: int):
    adict = {}
    net_con = psutil.net_connections()
    for con_info in net_con:
        if con_info.laddr.port == port:
            adict['port'] = port
            adict['type'] = int(con_info.type)
            adict['proc'] = psutil.Process(con_info.pid).name()
            adict['ip'] = con_info.laddr.ip
            break
    return adict


def get_port_status():
    AList = []
#    count = 65535
    count = 13107
    for i in PortPool:
        if NetPortPid(i) == {}:
            count -= 1
        else:
            count -= 1
            AList.append(NetPortPid(i))
            print('正在扫描端口，剩余端口数量%d'%(count))
    print('端口扫描完成，活动端口数量：%d' % (len(AList)))
    return AList
