from win32api import *
from win32con import *


def GetSoftInfo():
    keyName = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\WOW6432Node\\Microsoft\\Windows\\CurrentVersion\\Uninstall'
    key = ''
    name = str.split(keyName, '\\', 1)
    try:
        if name[0] == 'HKEY_LOCAL_MACHINE':
            key = RegOpenKey(HKEY_LOCAL_MACHINE, name[1], 0, KEY_READ)
        info = RegQueryInfoKey(key)
        soft_list = []
        for i in range(0, info[0]):
            key_name = RegEnumKey(key, i)
            key_path = name[1]+'\\'+key_name
            child_key = RegOpenKey(HKEY_LOCAL_MACHINE, key_path, 0, KEY_READ)
            try:
                display_name, REG_SZ = RegQueryValueEx(child_key, 'Displayname')
                publisher, REG_SZ = RegQueryValueEx(child_key, 'Publisher')
                version, REG_SZ = RegQueryValueEx(child_key, 'Version')
                installdata, REG_SZ = RegQueryValueEx(child_key, 'InstallDate')
                installdata=installdata[0:4]+"年"+installdata[4:6]+"月"+installdata[6:8]+"日"
                installsource, REG_SZ = RegQueryValueEx(child_key, 'InstallSource')
                soft_list.append({ 'name':display_name, 'publisher':publisher,  'version':version,  'data':installdata, 'source':installsource})
            except:
                continue

        RegCloseKey(key)
        return soft_list
    except Exception as e:
        print(e)

