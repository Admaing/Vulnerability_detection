$(document).ready(function () {
    $.ajax({
        cache: true,
        type: "POST",
        url: "/asset/asset_list/",
        async: true,
        error: function () {
            window.alert('请选择网段')
        },
        success: function (request) {
            host_network_segment(request)
        }
    });
});

// function setCookie(name,value){
//     var exp=new Date();
//     exp.setTime(exp.getTime()+24*60*60*1000);
//     document.cookie=name+"="+escape(value)+";expires="+exp.toDateString();
// }
// function getCookie(name){
//     var regExp=new RegExp("(^| )")+name+"=({^;]*)(;|$)";
//     var arr=document.cookie.match(regExp);
//     if(arr==null){
//         return null;
//     }
//     return unrescape(arr[2]);
// }

//选择网段
function host_network_segment(request) {
    var netList = JSON.parse(request)
    if (netList.length) {
        var trHtml = '<option selected">请选择所属网段</option>'
        for (var i = 0; i < netList.length; i++) {
            var ip = netList[i]
            trHtml = trHtml + '<option value="/asset/asset_status/?net=' + ip + '" >' + ip + '</option>'
        }
        trHtml = trHtml + '</tr>'
        $("#networksegment_select").html(trHtml);
    } else {
        window.alert('网络异常')
    }
}



// setInterval(function (){
//     netChange();
// },10000)

function netChange() {
    var values = document.getElementById("networksegment_select");
    var path = values.options[values.selectedIndex].value;
    $.ajax({
        cache: false,
        type: "GET",
        url: path,
        async: true,
        error: function () {
            window.alert(path)
        },
        success: function (request) {
            var dataList = JSON.parse(request)
            var status = '离线'
            if (dataList.length) {
                var trHtml = '<tr>' +'<th>资产编号</th>' +
                    '<th>主机名</th>' +
                    '<th>IP地址</th>' +
                    '<th>MAC地址</th>' +
                    '<th>创建时间</th>'+
                    '<th>修改时间</th>' +
                    '<th>状态</th>';
                for (var i = 0; i < dataList.length; i++) {
                    var ip = dataList[i]["fields"]["ip"]
                    if (dataList[i]["fields"]["status"] === 0) {
                        status = '离线'
                    } else {
                        status = '在线'
                    }
                    trHtml = trHtml + '<tr>' +
                        '<td>' + dataList[i]["pk"] + '</td>' +
                        '<td>' + dataList[i]["fields"]["hostname"] + '</td>' +
                        '<td>' + '<a href="/asset/asset_detail?ip=' + ip + '">' + dataList[i]["fields"]["ip"] + '</a>' + '</td>' +
                        '<td>' + dataList[i]["fields"]["mac"] + '</td>' +
                        '<td>' + dataList[i]["fields"]["createtime"] + '</td>' +
                        '<td>' + dataList[i]["fields"]["updatetime"] + '</td>' +
                        '<td>' + status + '</td>'
                        + '</tr>'
                }
                trHtml = trHtml + '</tr>'
                $("#group_count").html(trHtml);
            }
        }
    });

}

